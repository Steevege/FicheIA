<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#2980b9">
  <title>FicheIA</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="assets/icon-192.png">
  <link rel="stylesheet" href="css/app.css">
</head>
<body>
  <div id="app">

    <!-- √âCRAN ACCUEIL -->
    <div id="screen-home" class="screen active">
      <header class="app-header">
        <h1 class="app-title">FicheIA</h1>
        <div class="header-actions">
          <button id="btn-help" class="btn-icon" aria-label="Aide">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
          </button>
          <button id="btn-settings" class="btn-icon" aria-label="Param√®tres">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg>
          </button>
        </div>
      </header>
      <main class="home-content">
        <button id="btn-new-fiche" class="btn-primary btn-large">
          <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
          Nouvelle fiche
        </button>
        <button id="btn-history" class="btn-secondary btn-large">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M7 16l4-8 4 4 4-6"/></svg>
          <span>Mes fiches <span id="history-count"></span></span>
        </button>
        <div id="api-status" class="api-status"></div>
      </main>
    </div>

    <!-- √âCRAN IMPORT PHOTOS -->
    <div id="screen-import" class="screen">
      <header class="app-header">
        <button class="btn-back" data-target="home">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <h2 class="header-title">Import photos</h2>
        <div class="header-spacer"></div>
      </header>
      <main class="import-content" id="drop-zone">
        <div id="drop-overlay" class="drop-overlay" hidden>
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          <p>Glisse tes photos ici</p>
        </div>
        <div id="photo-grid" class="photo-grid"></div>
        <div class="import-actions">
          <button id="btn-add-camera" class="btn-add" aria-label="Prendre une photo">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
            Photo
          </button>
          <button id="btn-add-gallery" class="btn-add" aria-label="Choisir depuis la galerie">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="M21 15l-5-5L5 21"/></svg>
            Galerie
          </button>
        </div>
        <input type="file" id="input-camera" accept="image/*" capture="environment" hidden>
        <input type="file" id="input-gallery" accept="image/*" multiple hidden>
        <p id="photo-count" class="photo-count"></p>
        <button id="btn-to-config" class="btn-primary btn-large" disabled>
          Configurer
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </main>
    </div>

    <!-- √âCRAN CONFIGURATION -->
    <div id="screen-config" class="screen">
      <header class="app-header">
        <button class="btn-back" data-target="import">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <h2 class="header-title">Configuration</h2>
        <div class="header-spacer"></div>
      </header>
      <main class="config-content">
        <div id="config-loading" class="config-loading">
          <div class="spinner"></div>
          <p>Analyse en cours...</p>
        </div>
        <div id="config-form" class="config-form" hidden>
          <label class="form-label">Mati√®re d√©tect√©e :</label>
          <select id="select-subject" class="form-select">
            <option value="Physique-Chimie">Physique-Chimie</option>
            <option value="Math√©matiques">Math√©matiques</option>
            <option value="SVT">SVT / Biologie</option>
            <option value="Histoire-G√©o">Histoire-G√©o</option>
            <option value="Fran√ßais">Fran√ßais / Lettres</option>
            <option value="Philosophie">Philosophie</option>
            <option value="Langues">Langues</option>
            <option value="√âconomie">√âconomie / SES</option>
            <option value="Autre">Autre</option>
          </select>

          <label class="form-label">Niveau :</label>
          <div id="level-picker" class="pill-picker">
            <button class="pill active" data-value="seconde">Seconde</button>
            <button class="pill" data-value="premiere">Premi√®re</button>
            <button class="pill" data-value="terminale">Terminale</button>
          </div>

          <label class="form-label">Type de fiche :</label>
          <div id="type-picker" class="pill-picker">
            <button class="pill active" data-value="revision">R√©vision</button>
            <button class="pill" data-value="resume">R√©sum√©</button>
            <button class="pill" data-value="flashcards">Flashcards</button>
            <button class="pill" data-value="methode">M√©thode</button>
          </div>

          <label class="form-label">Densit√© :</label>
          <div id="density-picker" class="pill-picker">
            <button class="pill" data-value="compact">Compact</button>
            <button class="pill active" data-value="normal">Normal</button>
            <button class="pill" data-value="detaille">D√©taill√©</button>
          </div>

          <label class="form-label">Th√®me couleur :</label>
          <div id="color-picker" class="color-picker">
            <button class="color-dot active" data-main="#2980b9" data-accent="#e67e22" style="background:#2980b9" aria-label="Bleu"></button>
            <button class="color-dot" data-main="#8e44ad" data-accent="#e74c3c" style="background:#8e44ad" aria-label="Violet"></button>
            <button class="color-dot" data-main="#27ae60" data-accent="#f39c12" style="background:#27ae60" aria-label="Vert"></button>
            <button class="color-dot" data-main="#c0392b" data-accent="#16a085" style="background:#c0392b" aria-label="Rouge"></button>
            <button class="color-dot" data-main="#f39c12" data-accent="#2980b9" style="background:#f39c12" aria-label="Orange"></button>
          </div>

          <label class="form-label">Taille de police : <span id="font-size-value">14</span>px</label>
          <input type="range" id="slider-fontsize" class="form-slider" min="10" max="22" value="14" step="1">

          <div class="toggle-row">
            <label class="form-label">Ajouter une synth√®se</label>
            <label class="toggle">
              <input type="checkbox" id="toggle-synthesis">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <label class="form-label">Instructions pour l'IA :</label>
          <textarea id="custom-instructions" class="form-textarea" rows="3" placeholder="Ex : insiste sur les dates, ajoute des moyens mn√©motechniques..."></textarea>

          <button id="btn-generate" class="btn-primary btn-large btn-generate">
            G√©n√©rer la fiche
          </button>
        </div>
      </main>
    </div>

    <!-- √âCRAN VIEWER -->
    <div id="screen-viewer" class="screen">
      <header class="app-header">
        <button class="btn-back" data-target="home">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <h2 id="viewer-title" class="header-title">Fiche</h2>
        <div class="header-spacer"></div>
      </header>
      <main class="viewer-content">
        <div class="viewer-toolbar">
          <label class="toolbar-label">Taille :</label>
          <input type="range" id="slider-viewer-fontsize" class="form-slider toolbar-slider" min="10" max="22" value="14" step="1">
          <span id="viewer-fontsize-value" class="toolbar-value">14px</span>
          <button id="btn-fullscreen" class="btn-icon" aria-label="Plein √©cran" style="color:var(--text-light);margin-left:auto;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"/><polyline points="9 21 3 21 3 15"/><line x1="21" y1="3" x2="14" y2="10"/><line x1="3" y1="21" x2="10" y2="14"/></svg>
          </button>
        </div>
        <div id="generation-progress" class="generation-progress" hidden>
          <div class="spinner"></div>
          <p id="generation-message">Analyse des photos...</p>
        </div>
        <div id="fiche-container" class="fiche-container" hidden>
          <iframe id="fiche-iframe" class="fiche-iframe" sandbox="allow-same-origin"></iframe>
        </div>
        <div class="viewer-actions">
          <button id="btn-pdf" class="btn-action" title="Exporter PDF">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>
            PDF
          </button>
          <button id="btn-print" class="btn-action" title="Imprimer">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 01-2-2v-5a2 2 0 012-2h16a2 2 0 012 2v5a2 2 0 01-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></svg>
            Imprimer
          </button>
          <button id="btn-save" class="btn-action" title="Sauvegarder">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            Sauver
          </button>
          <button id="btn-edit" class="btn-action" title="Modifier le HTML">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
            Modifier
          </button>
          <button id="btn-regenerate" class="btn-action" title="R√©g√©n√©rer la fiche">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/></svg>
            Refaire
          </button>
          <button id="btn-copy-text" class="btn-action" title="Copier le texte">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
            Copier
          </button>
          <button id="btn-share" class="btn-action" title="Copier le HTML">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            Partager
          </button>
          <button id="btn-work" class="btn-action" title="Travailler sur cette fiche">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>
            Travailler
          </button>
        </div>
      </main>
      <!-- √âditeur HTML (cach√© par d√©faut) -->
      <div id="editor-overlay" class="editor-overlay" hidden>
        <div class="editor-header">
          <h3>Modifier le HTML</h3>
          <button id="btn-close-editor" class="btn-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <textarea id="html-editor" class="html-editor"></textarea>
        <button id="btn-apply-edit" class="btn-primary">Appliquer les modifications</button>
      </div>
    </div>

    <!-- √âCRAN HISTORIQUE -->
    <div id="screen-history" class="screen">
      <header class="app-header">
        <button class="btn-back" data-target="home">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <h2 class="header-title">Mes fiches</h2>
        <div class="header-spacer"></div>
      </header>
      <main class="history-content">
        <div class="history-filters">
          <input type="search" id="history-search" class="form-input history-search" placeholder="Rechercher...">
          <select id="history-filter-subject" class="form-select history-filter-select">
            <option value="">Toutes mati√®res</option>
            <option value="Physique-Chimie">Physique-Chimie</option>
            <option value="Math√©matiques">Math√©matiques</option>
            <option value="SVT">SVT</option>
            <option value="Histoire-G√©o">Histoire-G√©o</option>
            <option value="Fran√ßais">Fran√ßais</option>
            <option value="Philosophie">Philosophie</option>
            <option value="Langues">Langues</option>
            <option value="√âconomie">√âconomie</option>
            <option value="Autre">Autre</option>
          </select>
          <select id="history-sort" class="form-select history-filter-select">
            <option value="recent">Plus r√©centes</option>
            <option value="ancien">Plus anciennes</option>
            <option value="matiere">Par mati√®re</option>
            <option value="alpha">Alphab√©tique</option>
          </select>
        </div>
        <div id="history-list" class="history-list"></div>
        <p id="history-empty" class="history-empty" hidden>Aucune fiche sauvegard√©e</p>
      </main>
    </div>

    <!-- √âCRAN TRAVAILLER -->
    <div id="screen-work" class="screen">
      <header class="app-header">
        <button class="btn-back" data-target="home">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
        </button>
        <h2 class="header-title">Travailler</h2>
        <div class="header-spacer"></div>
      </header>
      <main class="work-content">
        <p class="work-source">Fiche : <strong id="work-source-title"></strong></p>

        <!-- MENU PRINCIPAL -->
        <div id="work-panel-menu" class="work-panel">
          <div class="work-free-row">
            <input type="text" id="work-free-input" class="form-input" placeholder="Pose une question sur le cours...">
            <button id="btn-free-question" class="btn-primary btn-free-go">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
            </button>
          </div>
          <div class="work-modes-grid">
            <button class="work-mode-btn" data-panel="questions">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
              <span>Questions</span>
            </button>
            <button class="work-mode-btn" data-panel="exercices">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
              <span>Exercices</span>
            </button>
            <button class="work-mode-btn" data-panel="redaction">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
              <span>R√©daction</span>
            </button>
            <button class="work-mode-btn" data-panel="chat">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
              <span>Discuter</span>
            </button>
            <button class="work-mode-btn" data-panel="methode">
              <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 014 4v14a3 3 0 00-3-3H2z"/><path d="M22 3h-6a4 4 0 00-4 4v14a3 3 0 013-3h7z"/></svg>
              <span>M√©thode</span>
            </button>
          </div>
        </div>

        <!-- PANNEAU QUESTIONS -->
        <div id="work-panel-questions" class="work-panel" hidden>
          <button class="btn-work-back">‚Üê Retour</button>
          <h3 class="work-panel-title">G√©n√©rer des questions</h3>

          <label class="form-label">Format :</label>
          <div id="work-questions-format" class="pill-picker">
            <button class="pill active" data-value="mix">Mix</button>
            <button class="pill" data-value="qcm">QCM</button>
            <button class="pill" data-value="ouvertes">Ouvertes</button>
            <button class="pill" data-value="vf">Vrai/Faux</button>
          </div>

          <label class="form-label">Nombre : <span id="work-questions-count-label">5</span></label>
          <input type="range" id="work-questions-count" class="form-slider" min="3" max="15" value="5" step="1">

          <label class="form-label">Difficult√© :</label>
          <div id="work-questions-difficulty" class="pill-picker">
            <button class="pill" data-value="facile">Facile</button>
            <button class="pill active" data-value="moyen">Moyen</button>
            <button class="pill" data-value="difficile">Difficile</button>
          </div>

          <button id="btn-gen-questions" class="btn-primary btn-large">G√©n√©rer les questions</button>
        </div>

        <!-- PANNEAU EXERCICES -->
        <div id="work-panel-exercices" class="work-panel" hidden>
          <button class="btn-work-back">‚Üê Retour</button>
          <h3 class="work-panel-title">G√©n√©rer des exercices</h3>

          <label class="form-label">Type :</label>
          <div id="work-exercices-type" class="pill-picker">
            <button class="pill active" data-value="application">Application</button>
            <button class="pill" data-value="analyse">Analyse</button>
            <button class="pill" data-value="synthese">Synth√®se</button>
            <button class="pill" data-value="probleme">Probl√®me</button>
          </div>

          <label class="form-label">Nombre : <span id="work-exercices-count-label">3</span></label>
          <input type="range" id="work-exercices-count" class="form-slider" min="1" max="8" value="3" step="1">

          <div class="toggle-row">
            <label class="form-label">Inclure le corrig√©</label>
            <label class="toggle">
              <input type="checkbox" id="work-exercices-correction" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <button id="btn-gen-exercices" class="btn-primary btn-large">G√©n√©rer les exercices</button>
        </div>

        <!-- PANNEAU R√âDACTION -->
        <div id="work-panel-redaction" class="work-panel" hidden>
          <button class="btn-work-back">‚Üê Retour</button>
          <h3 class="work-panel-title">Aide √† la r√©daction</h3>

          <label class="form-label">Sujet / Question :</label>
          <textarea id="work-redaction-subject" class="form-textarea" rows="3" placeholder="Ex : En quoi la R√©volution fran√ßaise a-t-elle transform√© la soci√©t√© ?"></textarea>

          <label class="form-label">Type de travail :</label>
          <div id="work-redaction-type" class="pill-picker">
            <button class="pill active" data-value="explication">Explication</button>
            <button class="pill" data-value="dissertation">Dissertation</button>
            <button class="pill" data-value="commentaire">Commentaire</button>
            <button class="pill" data-value="plan">Plan d√©taill√©</button>
          </div>

          <button id="btn-gen-redaction" class="btn-primary btn-large">G√©n√©rer</button>
        </div>

        <!-- PANNEAU CHAT -->
        <div id="work-panel-chat" class="work-panel" hidden>
          <button class="btn-work-back">‚Üê Retour</button>
          <h3 class="work-panel-title">Discuter du cours</h3>
          <div id="chat-messages" class="chat-messages"></div>
          <div id="chat-loading" class="chat-loading" hidden>
            <span class="chat-dots"><span>.</span><span>.</span><span>.</span></span>
          </div>
          <div class="chat-input-bar">
            <textarea id="chat-input" class="form-textarea chat-textarea" rows="1" placeholder="Pose ta question..."></textarea>
            <button id="btn-chat-send" class="btn-primary btn-chat-send">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
          </div>
          <button id="btn-chat-to-fiche" class="btn-secondary btn-chat-to-fiche">Transformer en fiche</button>
        </div>

        <!-- PANNEAU M√âTHODE -->
        <div id="work-panel-methode" class="work-panel" hidden>
          <button class="btn-work-back">‚Üê Retour</button>
          <h3 class="work-panel-title">Fiche m√©thode</h3>

          <label class="form-label">Sujet / Comp√©tence :</label>
          <textarea id="work-methode-subject" class="form-textarea" rows="3" placeholder="Ex : Comment analyser un graphique en SVT, Comment r√©diger une intro de dissertation..."></textarea>

          <button id="btn-gen-methode" class="btn-primary btn-large">G√©n√©rer la fiche m√©thode</button>
        </div>
      </main>
    </div>

    <!-- MODAL PARAM√àTRES -->
    <div id="modal-settings" class="modal" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Param√®tres</h3>
          <button id="btn-close-settings" class="btn-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <div class="modal-body">
          <label class="form-label" for="input-api-key">Cl√© API Anthropic :</label>
          <div class="api-key-row">
            <input type="password" id="input-api-key" class="form-input" placeholder="sk-ant-api03-...">
            <button id="btn-toggle-key" class="btn-icon" aria-label="Afficher/masquer la cl√©">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
            </button>
          </div>
          <div class="settings-actions">
            <button id="btn-test-api" class="btn-secondary">Tester</button>
            <button id="btn-save-api" class="btn-primary">Sauvegarder</button>
          </div>
          <p id="api-test-result" class="api-test-result"></p>

          <hr class="settings-divider">

          <label class="form-label">Police par d√©faut : <span id="settings-fontsize-value">14</span>px</label>
          <input type="range" id="slider-settings-fontsize" class="form-slider" min="10" max="22" value="14" step="1">

          <label class="form-label" for="select-default-subject">Mati√®re par d√©faut :</label>
          <select id="select-default-subject" class="form-select">
            <option value="">Auto-d√©tection</option>
            <option value="Physique-Chimie">Physique-Chimie</option>
            <option value="Math√©matiques">Math√©matiques</option>
            <option value="SVT">SVT / Biologie</option>
            <option value="Histoire-G√©o">Histoire-G√©o</option>
            <option value="Fran√ßais">Fran√ßais / Lettres</option>
            <option value="Philosophie">Philosophie</option>
            <option value="Langues">Langues</option>
            <option value="√âconomie">√âconomie / SES</option>
            <option value="Autre">Autre</option>
          </select>

          <label class="form-label">Mod√®le IA :</label>
          <div id="model-picker" class="pill-picker">
            <button class="pill active" data-value="sonnet">Sonnet 4.6 (qualit√©)</button>
            <button class="pill" data-value="haiku">Haiku 4.5 (rapide)</button>
          </div>

          <hr class="settings-divider">

          <label class="form-label">Instructions par mati√®re :</label>
          <select id="select-instruction-subject" class="form-select">
            <option value="Physique-Chimie">Physique-Chimie</option>
            <option value="Math√©matiques">Math√©matiques</option>
            <option value="SVT">SVT</option>
            <option value="Histoire-G√©o">Histoire-G√©o</option>
            <option value="Fran√ßais">Fran√ßais</option>
            <option value="Philosophie">Philosophie</option>
            <option value="Langues">Langues</option>
            <option value="√âconomie">√âconomie</option>
            <option value="Autre">Autre</option>
          </select>
          <textarea id="subject-instructions" class="form-textarea" rows="2" placeholder="Ex : toujours encadrer les formules, insister sur les d√©monstrations..."></textarea>
          <button id="btn-save-instruction" class="btn-secondary" style="align-self:flex-start;">Enregistrer</button>

          <div class="toggle-row">
            <label class="form-label">Mode sombre</label>
            <label class="toggle">
              <input type="checkbox" id="toggle-darkmode">
              <span class="toggle-slider"></span>
            </label>
          </div>

          <hr class="settings-divider">

          <label class="form-label">Donn√©es :</label>
          <div class="settings-actions">
            <button id="btn-export" class="btn-secondary">Exporter</button>
            <button id="btn-import" class="btn-secondary">Importer</button>
          </div>
          <input type="file" id="input-import" accept=".json" hidden>

          <hr class="settings-divider">

          <button id="btn-force-update" class="btn-secondary" style="width:100%;">Forcer la mise √† jour</button>
        </div>
      </div>
    </div>

    <!-- MODAL AIDE -->
    <div id="modal-help" class="modal" hidden>
      <div class="modal-backdrop"></div>
      <div class="modal-content">
        <div class="modal-header">
          <h3>Aide</h3>
          <button id="btn-close-help" class="btn-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <div class="modal-body">

          <div class="help-section">
            <h4>FicheIA, c'est quoi ?</h4>
            <p>Transforme tes photos de notes manuscrites en fiches de r√©vision claires et structur√©es, gr√¢ce √† l'IA. Gratuit, sans compte, tout reste sur ton appareil.</p>
          </div>

          <div class="help-section">
            <h4>Installer sur ton appareil</h4>
            <div class="help-platform">
              <span class="help-platform-icon">üì±</span>
              <div>
                <strong>iPhone / iPad</strong>
                <ol class="help-steps">
                  <li>Ouvre FicheIA dans <strong>Safari</strong></li>
                  <li>Appuie sur le bouton <strong>Partager</strong> (carr√© avec fl√®che)</li>
                  <li>Choisis <strong>Sur l'√©cran d'accueil</strong></li>
                </ol>
              </div>
            </div>
            <div class="help-platform">
              <span class="help-platform-icon">ü§ñ</span>
              <div>
                <strong>Android</strong>
                <ol class="help-steps">
                  <li>Ouvre FicheIA dans <strong>Chrome</strong></li>
                  <li>Appuie sur le menu <strong>&#8942;</strong> (3 points)</li>
                  <li>Choisis <strong>Installer l'application</strong></li>
                </ol>
              </div>
            </div>
            <div class="help-platform">
              <span class="help-platform-icon">üíª</span>
              <div>
                <strong>Mac</strong>
                <ol class="help-steps">
                  <li>Ouvre FicheIA dans <strong>Chrome</strong> ou <strong>Edge</strong></li>
                  <li>Clique sur l'ic√¥ne <strong>Installer</strong> dans la barre d'adresse</li>
                </ol>
              </div>
            </div>
            <div class="help-platform">
              <span class="help-platform-icon">ü™ü</span>
              <div>
                <strong>PC Windows</strong>
                <ol class="help-steps">
                  <li>Ouvre FicheIA dans <strong>Chrome</strong> ou <strong>Edge</strong></li>
                  <li>Clique sur <strong>Installer</strong> dans la barre d'adresse</li>
                </ol>
              </div>
            </div>
          </div>

          <div class="help-section">
            <h4>Configurer ta cle API</h4>
            <ol class="help-steps">
              <li>Appuie sur l'ic√¥ne <strong>engrenage</strong> (Param√®tres)</li>
              <li>Entre ta <strong>cl√© API Anthropic</strong> (commence par sk-ant-...)</li>
              <li>Appuie sur <strong>Tester</strong> pour v√©rifier</li>
              <li>Appuie sur <strong>Sauvegarder</strong></li>
            </ol>
          </div>

          <div class="help-section">
            <h4>Cr√©er une fiche</h4>
            <ol class="help-steps">
              <li>Appuie sur <strong>Nouvelle fiche</strong></li>
              <li>Prends en photo ou importe tes <strong>notes manuscrites</strong></li>
              <li>Configure la <strong>mati√®re</strong>, le <strong>niveau</strong> et le <strong>type de fiche</strong></li>
              <li>Appuie sur <strong>G√©n√©rer la fiche</strong></li>
              <li>Sauvegarde, imprime ou exporte en PDF</li>
            </ol>
          </div>

          <div class="help-section">
            <h4>Mode Travailler</h4>
            <p>Depuis une fiche sauvegard√©e, appuie sur <strong>Travailler</strong> pour :</p>
            <ul class="help-steps help-list">
              <li><strong>Questions</strong> ‚Äî QCM, vrai/faux, questions ouvertes</li>
              <li><strong>Exercices</strong> ‚Äî Application, analyse, synth√®se</li>
              <li><strong>R√©daction</strong> ‚Äî Aide √† la dissertation, commentaire</li>
              <li><strong>Discuter</strong> ‚Äî Chat avec l'IA sur le cours</li>
              <li><strong>M√©thode</strong> ‚Äî Fiches m√©thode personnalis√©es</li>
            </ul>
          </div>

        </div>
      </div>
    </div>

  </div>

  <script src="js/history.js"></script>
  <script src="js/api.js"></script>
  <script src="js/generator.js"></script>
  <script src="js/pdf.js"></script>
  <script src="js/work.js"></script>
  <script src="js/app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js');
    }
  </script>
</body>
</html>
